<!doctype html>
<html lang="en">
<head>
<script>
// GATE4_HEAD_SHIM: defines window.updateNetworkPill early
(function(){
  if (typeof window === 'undefined') return;

  // Ensure env defaults
  window.EXWIFE_ENV = window.EXWIFE_ENV || {
    network: 'mainnet',
    presale: '0xF4A37B656A33d418FB37280c9304274078A9b3ed'
  };
  window.PRESALE_ADDRESS = window.EXWIFE_ENV.presale || window.PRESALE_ADDRESS;

  async function _updateNetworkPill(){
    const pillEl = document.getElementById('netPill');
    const buyBtn = document.getElementById('buyBtn');
    const scanLink = document.getElementById('scanLink');

    let pill = 'Ethereum', buyDisabled = false;
    try {
      if (window.ethereum?.request) {
        const idHex = await window.ethereum.request({ method: 'eth_chainId' }).catch(()=>null);
        const id = idHex ? parseInt(idHex, 16) : 1;
        if (id !== 1) { pill = 'Wrong Network'; buyDisabled = true; }
      } else {
        pill = 'No Wallet'; buyDisabled = false;
      }
    } catch (e) {
      pill = 'Error'; buyDisabled = true;
    }

    if (pillEl) pillEl.textContent = pill;
    if (buyBtn != null) buyBtn.disabled = buyDisabled;
    if (scanLink) scanLink.href = `https://etherscan.io/address/${window.PRESALE_ADDRESS}`;
    return { pill, buyDisabled, href: scanLink?.href || null };
  }

  // Only set if not already defined; otherwise keep existing
  if (typeof window.updateNetworkPill !== 'function') {
    window.updateNetworkPill = _updateNetworkPill;
  }

  // Auto-run once
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => window.updateNetworkPill());
  } else {
    window.updateNetworkPill();
  }
})();

</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EXWIFE — Presale (Mainnet)</title>

  <!-- Ethers UMD -->
<!-- Node 'process' shim for browser -->
<script>
  // Some UMD bundles check process.env
  window.global = window.global || window;
  window.process = window.process || { env: {} };
</script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>

  <!-- ENV -->
  <script>
    window.EXWIFE_ENV = {
      network: 'mainnet',
      rpc: 'https://eth.drpc.org',
      presale: '0xF4A37B656A33d418FB37280c9304274078A9b3ed',
      token:   '0xd0F4f922891cBfaDB73511df7af66dE15DA93C94',
      symbol:  'EXWIFE',
      goalEth: 1200
    };
    window.GOAL_ETH = 1200;
    window.PRESALE_ADDRESS = window.EXWIFE_ENV.presale;
    window.PRESALE_ABI_MIN = [
      "function paused() view returns (bool)",
      "function totalRaisedWei() view returns (uint256)",
      "function weiRaised() view returns (uint256)",
      "function buy() payable"
    ];
  </script>

  <!-- Minimal styles -->
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto; background:#0e0f12; color:#e7e7ea; margin:0; }
    .pill { display:inline-block; background:#1c1d22; border:1px solid #2a2b31; padding:6px 10px; border-radius:999px; }
    .btn { background:#2d6cdf; border:none; color:#fff; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
    .wrap { max-width:680px; margin:40px auto; padding:0 16px; }
  </style>
  <!-- GATE10-FINGERPRINT: g10-verify-001 -->
<script id="walletconnect-loader">
(async () => {
  // Load Web3Modal + WalletConnect UMD bundles when needed
  function add(src){ return new Promise((res,rej)=>{ const s=document.createElement("script"); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s); }); }
  if (!window.ethereum) {
    await add("https://unpkg.com//ethereum-provider/dist/index.umd.js");
  }
})();
</script>
</head>
<!doctype html>
<html lang="en">
<head>
  <!-- EXWIFE v12.3 + UX POLISH v1: banner/countdown, progress numbers, toasts -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EXWIFE Presale (Mainnet) — v12.3</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/img/exwife-hero.png" />

  <!-- Ethers UMD (single include; no async/defer) -->
  

  <!-- ENV + minimal ABI -->
  

  <!-- Safe subscription shim: skip subscribing to missing events -->
  

  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu; background:#0e0f12; color:#e7e7ea; }
    .wrap { max-width:680px; margin:40px auto; padding:0 16px; }
    .card { background:#141417; border:1px solid #222; border-radius:14px; padding:18px; }
    .row { display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .pill { background:#1c1d22; border:1px solid #2a2b31; padding:6px 10px; border-radius:999px; }
    .btn { background:#2d6cdf; border:none; color:#fff; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .progress { width:100%; height:14px; background:#1a1b20; border:1px solid #2a2b31; border-radius:10px; overflow:hidden; margin-top:8px; }
    .bar { height:100%; width:2%; background:#22c55e; transition: width .6s ease; }
    code { background:#101115; border:1px solid #222; padding:2px 6px; border-radius:8px; }
    .muted { opacity:.85; }
    a { color:#9bbcff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    input::placeholder { color:#9aa; }

    /* === UX POLISH v1: banner + progress numbers + toasts === */
    .banner {
      display:flex; gap:.5rem; align-items:center; justify-content:center;
      padding:.6rem .9rem; margin:12px auto 14px; max-width:980px;
      background:#111; color:#fff; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.25);
      font-weight:600;
    }
    .banner .countdown { opacity:.9; font-weight:500; }

    .progress-wrap { max-width:900px; margin:10px auto 0; }
    .progress-head { display:flex; justify-content:space-between; margin-bottom:.35rem; font-weight:600; }
    .progress-outer {
      width:100%; height:14px; background:#1a1b20; border:1px solid #2a2b31; border-radius:999px; overflow:hidden;
      box-shadow:inset 0 1px 2px rgba(0,0,0,.08);
    }
    .progress-inner { height:100%; width:0%; background:linear-gradient(90deg, #5ac8fa, #34c759, #ffd60a); transition:width .35s ease-in-out; }

    .toast-stack { position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999; }
    .toast {
      min-width:260px; max-width:360px; padding:.75rem .9rem; border-radius:12px; color:#fff;
      background:#333; box-shadow:0 10px 24px rgba(0,0,0,.25); font-weight:600;
    }
    .toast.ok { background:#2e7d32; }
    .toast.err { background:#c62828; }
    .toast.info { background:#2c3e50; }
    .toast .sub { display:block; font-weight:500; opacity:.9; margin-top:.15rem; }
  </style>
<!-- === GATE5_SEO_BLOCK v1 === -->
<title>EXWIFE Token — Fair, Fun, and A Little Petty</title>
<meta name="description" content="EXWIFE (EXWIFE) — a cheeky, fair-launch presale on Ethereum. Buy in, watch the drama, and enjoy the ride.">

<link rel="canonical" href="https://exwifetoken.com/">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0a0a0a">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://exwifetoken.com/">
<meta property="og:title" content="EXWIFE Token — Fair, Fun, and A Little Petty">
<meta property="og:description" content="EXWIFE (EXWIFE) — a cheeky, fair-launch presale on Ethereum.">
<meta property="og:image" content="https://exwifetoken.com/img/social-card.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="EXWIFE Token — Fair, Fun, and A Little Petty">
<meta name="twitter:description" content="EXWIFE (EXWIFE) — a cheeky, fair-launch presale on Ethereum.">
<meta name="twitter:image" content="https://exwifetoken.com/img/social-card.png">

<!-- Icons / PWA (keep your existing favicon.ico; these are additive) -->
<link rel="icon" type="image/png" sizes="32x32" href="/img/icon-32.png">
<link rel="icon" type="image/png" sizes="192x192" href="/img/icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/icon-180.png">
<link rel="manifest" href="/site.webmanifest">

<!-- Structured data (minimal) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebSite",
  "name":"EXWIFE Token",
  "url":"https://exwifetoken.com/",
  "potentialAction":{
    "@type":"SearchAction",
    "target":"https://exwifetoken.com/?q={search_term_string}",
    "query-input":"required name=search_term_string"
  }
}
</script>
<!-- === /GATE5_SEO_BLOCK === -->

</head>
<body>

  <!-- Hero -->
  <header style="max-width:980px;margin:24px auto 6px;padding:0 12px;text-align:center">
    <img
      src="/img/exwife-hero.png"
      alt="EXWIFE Token"
      loading="lazy"
      style="max-width:100%;height:auto;border-radius:16px;display:inline-block;box-shadow:0 6px 24px rgba(0,0,0,.08)"
    />
    <h1 style="margin:14px 0 4px;font-size:28px;line-height:1.2;">EXWIFE Presale (Mainnet)</h1>
    <p style="margin:0;font-size:16px;opacity:.8">Goal: 1200 ETH • Safe, read-only UI until you connect</p>
  </header>

  <!-- Live banner + countdown -->
  <div id="presaleBanner" class="banner" role="status" aria-live="polite">
    <strong>Presale v3 live until Oct 12</strong>
    <span id="countdown" class="countdown">— calculating…</span>
  </div>

<h1 style="margin:0 0 6px;">EXWIFE Presale</h1>

    <div class="card">
      <div class="row">
        <div class="pill" id="status">Ready</div>
        <div class="pill" id="netPill" style="background:#3f3f46;border-color:#52525b">No Wallet</div>
        <div class="row" style="gap:8px;">
          <button class="btn" id="connectBtn" style="background:#475569">Connect</button>

          <div style="display:flex;gap:8px;align-items:center;background:#1c1d22;border:1px solid #2a2b31;border-radius:10px;padding:6px 8px;">
            <span style="opacity:.8">Amount</span>
            <input id="buyAmount" inputmode="decimal" placeholder="0.01" value="0.01"
                   style="width:90px;background:transparent;border:none;outline:none;color:#e7e7ea;font-weight:600;text-align:right" />
            <span style="opacity:.8">ETH</span>
          </div>

          <button class="btn" id="buyBtn">Buy 0.01 ETH</button>
          <button class="btn" id="refreshBtn" style="background:#374151">Refresh</button>
          <a id="txLink" class="pill" href="#" target="_blank" style="display:none;">View tx</a>
        </div>
      </div>

      <!-- Progress numbers + improved bar (keeps legacy IDs for compatibility) -->
      <div style="margin-top:14px;">
        <div class="progress-head">
          <span>Raised</span>
          <span id="progressNumbers">0.000 / 1200 ETH (0.00%)</span>
        </div>
        <div class="progress-outer" aria-label="Presale progress">
          <div id="progressBar" class="progress-inner" style="width:0%"></div>
        </div>

        <!-- legacy display retained so existing code still paints -->
        <div style="margin-top:10px">Raised: <strong id="raised">0.0000</strong> / <span id="goal-b">1200</span> ETH</div>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <div class="muted" style="margin-top:12px; word-break:break-all;">
        Presale: <code id="addr"></code>
        <div style="margin-top:6px;font-size:14px">
          <a id="scanLink" href="https://etherscan.io/address/0xF4A37B656A33d418FB37280c9304274078A9b3ed" target="_blank" rel="noopener">View on Etherscan</a>
          <button id="copyBtn" style="margin-left:8px;padding:4px 8px;border:1px solid #2a2b31;border-radius:8px;background:#1c1d22;color:#e7e7ea;cursor:pointer">Copy</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast container (notifications) -->
  <div id="toastStack" class="toast-stack" aria-live="polite" aria-atomic="true"></div>

  <!-- Core logic -->
  

    const signer  = await provider.getSigner();
    const addr    = window.PRESALE_ADDRESS;
    const abi     = window.PRESALE_ABI_MIN;
    const presale = new ethers.Contract(addr, abi, signer);

    // Amount + validation (tune as needed)
    const raw = (el('buyAmount')?.value || '').trim();
    const amt = Number(raw);
    const MIN = 0.001, MAX = 10;
    if (!isFinite(amt) || amt <= 0) { showToast('Enter an amount in ETH.', '', 'err'); setStatus('Ready'); return; }
    if (amt < MIN)                  { showToast(`Minimum is ${MIN} ETH`, '', 'err');  setStatus('Ready'); return; }
    if (amt > MAX)                  { showToast(`Maximum is ${MAX} ETH`, '', 'err');  setStatus('Ready'); return; }

    setStatus('Submitting tx…');
    showToast('Submitting transaction…', 'Confirm in your wallet', 'info', 3000);

    // Send tx
    const tx = await presale.buy({ value: ethers.parseEther(String(amt)) });

    // Explorer link depends on chain
    const link = el('txLink');
    const explorer = (chainIdStr === '11155111') ? 'https://sepolia.etherscan.io' : 'https://etherscan.io';
    if (link) { link.href = `${explorer}/tx/${tx.hash}`; link.style.display=''; }

    showToast('Buy submitted!', tx.hash.slice(0,10) + '…' + tx.hash.slice(-8), 'ok', 5200);
    await tx.wait();
    setStatus('✅ Confirmed');
    await window.EXWIFE_refreshRaised();

  } catch (e) {
    console.error('buy() failed:', e);
    setStatus('❌ Error');
    const msg = (e?.reason || e?.data?.message || e?.message || String(e));
    if (/insufficient funds/i.test(msg)) {
      showToast('Insufficient ETH', 'Top up for gas/amount', 'err', 6000);
    } else if (/user rejected/i.test(msg)) {
      showToast('Transaction rejected', '', 'err', 4200);
    } else {
      showToast('Buy failed', msg, 'err', 6500);
    }
  }
}

    // --- Paused pill updater; combines with network pill to control BUY ---
    async function updatePausedPill(){
      try {
        const ro = await getRO();
        const c  = new ethers.Contract(window.PRESALE_ADDRESS, window.PRESALE_ABI_MIN, ro);
        let isPaused = false; try { isPaused = await c.paused(); } catch (e) {}
        window.EXWIFE_STATE.paused = isPaused;
        setStatus(isPaused ? 'Paused' : 'Ready');
        await updateNetworkPill();
      } catch (e) {}
    }

    // Countdown banner (America/Chicago close time)
    const PRESALE_CLOSE_UNIX = Math.floor(new Date('2025-10-12T23:59:59-05:00').getTime() / 1000);
    (function bannerCountdown(){
      const countdownEl = document.getElementById('countdown');
      if (!countdownEl) return;
      function render() {
        const now = Math.floor(Date.now() / 1000);
        let diff = PRESALE_CLOSE_UNIX - now;
        if (diff <= 0) { countdownEl.textContent = '— closed'; return; }
        const d = Math.floor(diff / 86400); diff %= 86400;
        const h = Math.floor(diff / 3600);  diff %= 3600;
        const m = Math.floor(diff / 60);    const s = diff % 60;
        countdownEl.textContent = `— ${d}d ${h}h ${m}m ${s}s left`;
      }
      render();
      setInterval(render, 1000);
    })();

    // Optional: RPC/wallet helpful toasts based on the net pill
    (function rpcGuard(){
      const pill = document.getElementById('netPill');
      if (!pill) return;
      const check = () => {
        const t = (pill.textContent || '').trim();
        if (t.includes('No Wallet')) {
} else if (t.includes('Wrong')) {
  showToast('Wrong network', 'Please switch to Ethereum Mainnet (or Sepolia)', 'err', 5000);
}
      };
      setInterval(check, 8000);
      setTimeout(check, 1500);
    })();

    // --- Boot ---
    (function boot(){
      const addr = window.PRESALE_ADDRESS || '(missing)';

      // Static bits
      el('addr') && (el('addr').textContent = addr);
      // Default explorer to Mainnet; will be updated after connect if on Sepolia
el('scanLink') && (el('scanLink').href = `https://etherscan.io/address/${addr}`);

      // Listeners
      el('copyBtn')?.addEventListener('click', () => navigator.clipboard.writeText(addr));
      el('refreshBtn')?.addEventListener('click', () => EXWIFE_refreshRaised());
      el('connectBtn')?.addEventListener('click', async () => {
        if (!window.ethereum) { showToast('Install MetaMask to connect.', '', 'info'); return; }
        const mm = (window.ethereum.providers || []).find(p => p.isMetaMask)
                  || (window.ethereum.isMetaMask ? window.ethereum : window.ethereum);
        await mm.request({ method: 'eth_requestAccounts' });
        setStatus('Wallet connected');
        updateNetworkPill();
      });
      el('buyBtn')?.addEventListener('click', buyInline);

      // Keep Buy label in sync with amount
      const amt = el('buyAmount'); const buy = el('buyBtn');
      if (amt && buy) {
        const sync = () => { buy.textContent = `Buy ${amt.value || '0.01'} ETH`; };
        amt.addEventListener('input', sync); sync();
      }

      // React to wallet changes
      if (window.ethereum?.on) {
        window.ethereum.on('chainChanged', () => updateNetworkPill());
        window.ethereum.on('accountsChanged', () => updateNetworkPill());
      }

      // Initial paint + auto-refresh + initial pills
      const tick = async () => { try { await window.EXWIFE_refreshRaised(); } catch (e) { console.warn('tick failed:', e); } };
      tick();
      updatePausedPill();
      updateNetworkPill();
      window.EXWIFE_AUTO = window.EXWIFE_AUTO || {};
      clearInterval(window.EXWIFE_AUTO.raised);
      window.EXWIFE_AUTO.raised = setInterval(tick, 20000);
      document.addEventListener('visibilitychange', () => { if (!document.hidden) tick(); });

      console.log('EXWIFE v12.3 loaded (goal:', window.GOAL_ETH, 'ETH)');
    })();
  </script>

  <!-- Toasts UI (kept) -->
  <style>
    #exwifeToastHost{position:fixed;right:16px;top:16px;z-index:99999;display:flex;flex-direction:column;gap:10px;pointer-events:none}
    .exwifeToast{min-width:280px;max-width:360px;background:#101010;color:#eee;border:1px solid #2b2b2b;border-radius:14px;
      padding:10px 12px;box-shadow:0 10px 30px rgba(0,0,0,.35);font:14px/1.3 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      pointer-events:auto;opacity:0;transform:translateY(-6px);transition:opacity .18s ease, transform .18s ease}
    .exwifeToast.show{opacity:1;transform:translateY(0)}
    .exwifeToast .hdr{display:flex;align-items:center;gap:8px;font-weight:700;margin-bottom:4px}
    .exwifeToast .msg{opacity:.9;word-wrap:break-word}
    .exwifeToast.success{border-color:#235c2a}
    .exwifeToast.success .dot{width:10px;height:10px;border-radius:999px;background:#8df58d}
    .exwifeToast.error{border-color:#6a2525}
    .exwifeToast.error .dot{width:10px;height:10px;border-radius:999px;background:#ff8a8a}
    .exwifeToast.info{border-color:#2b2b2b}
    .exwifeToast.info .dot{width:10px;height:10px;border-radius:999px;background:#9bb2ff}
    .exwifeToast .x{margin-left:auto;opacity:.7;cursor:pointer}
  </style>
  <div id="exwifeToastHost" aria-live="polite"></div>
  

  <!-- Progress Animation (kept) -->
  <style>
    #progFill, [data-exwife-progress-fill]{ transition: width .9s cubic-bezier(.22,.8,.26,.99); will-change: width; }
  </style>
  

  <!-- Owner Panel (kept; now neutral to network) -->
  <style>
    #ownerPanel{position:fixed;right:12px;bottom:12px;z-index:9999}
    #ownerPanel details{background:#111;color:#eee;border:1px solid #333;border-radius:16px;padding:10px 12px;box-shadow:0 6px 24px rgba(0,0,0,.35);min-width:320px}
    #ownerPanel summary{cursor:pointer;list-style:none;font-weight:700}
    #ownerPanel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    #ownerPanel button{border:1px solid #2b2b2b;border-radius:12px;padding:8px 10px;cursor:pointer;background:#1b1b1b;color:#fff}
    #ownerPanel button[disabled]{opacity:.45;cursor:not-allowed}
    #ownerPanel .pill{display:inline-block;border:1px solid #2b2b2b;border-radius:999px;padding:2px 8px;margin-left:6px;font-size:12px}
    #ownerPanel .ok{color:#8df58d;border-color:#285e28}
    #ownerPanel .warn{color:#ffd16b;border-color:#7a5b24}
    #ownerPanel .bad{color:#ff8a8a;border-color:#6a2525}
    #ownerPanel .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  </style>

  <div id="ownerPanel">
    <details>
      <summary>Owner Panel
        <span id="opNet"  class="pill mono">…</span>
        <span id="opStat" class="pill mono">…</span>
      </summary>
      <div style="margin-top:8px;font-size:12px;opacity:.8">
        Presale: <span class="mono" id="opAddr">...</span>
      </div>
      <div class="row">
        <button id="opConnectBtn" title="Connect wallet (user-initiated)">Connect</button>
        <button id="opRefreshBtn" title="Refresh panel/status">Refresh</button>
      </div>
      <div style="margin-top:8px;font-size:12px">
        Wallet: <span id="opAcct" class="mono">not connected</span>
      </div>
      <div style="margin-top:8px">
        Raised: <span id="opRaised" class="mono">…</span> ETH
      </div>
      <div class="row" style="margin-top:10px">
        <button id="opPauseBtn"   title="This presale is windowed; pause/unpause not available" disabled>Pause (n/a)</button>
        <button id="opUnpauseBtn" title="This presale is windowed; pause/unpause not available" disabled>Unpause (n/a)</button>
        <button id="opWithdrawBtn">Withdraw</button>
        <button id="opFinalizeBtn">Finalize</button>
      </div>
      <div id="opMsg" style="margin-top:8px;font-size:12px;opacity:.85"></div>
    </details>
  </div>

  

  <!-- Force mainnet reader block was removed (we already have EXWIFE_refreshRaised above) -->

<script id="gate10-inline-amount">
/* gate10-inline-amount v5: adds WalletConnect provider when no injected wallet */
(() => {
  try {
    const $  = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
    let buy = $('#buyBtn'); if (!buy) return;

    // --- UI (single Amount field & clean) ---
    let label = $('#amountLabel');
    if (!label) { label = document.createElement('label'); label.id='amountLabel'; label.htmlFor='amount'; label.textContent='Amount (ETH)';
      label.style.cssText='display:block;margin:8px 0 4px;font-weight:600;font-size:14px;'; buy.parentNode.insertBefore(label,buy); }
    let amt = $('#amount'); if (!amt) { amt=document.createElement('input'); amt.id='amount'; amt.type='text'; buy.parentNode.insertBefore(amt,buy); }
    Object.assign(amt, { inputMode:'decimal', autocomplete:'off', spellcheck:false, placeholder: amt.placeholder||'e.g., 0.001' });
    amt.setAttribute('min','0.001'); amt.setAttribute('step','0.001');
    amt.style.cssText='display:block;width:100%;max-width:320px;box-sizing:border-box;padding:10px 12px;border:1px solid #ccc;border-radius:12px;font-size:16px;line-height:1.3;margin:0 0 8px';

    // Hide any other amount-like inputs
    $$('#amount, input[data-amount], input[name="amount"], input[type="number"], input[inputmode="decimal"], input[inputmode="numeric"]').forEach(x=>{ if(x!==amt) x.style.display='none'; });

    // Helpful mini Connect button (shown when needed)
    let connect = $('#connectBtn'); if (!connect) {
      connect = document.createElement('button'); connect.id='connectBtn'; connect.type='button';
      connect.textContent = 'Connect Wallet';
      connect.style.cssText='display:inline-block;margin:0 0 10px 0;padding:8px 12px;border-radius:10px;border:1px solid #bbb;background:#f6f7f9;color:#111;font-size:14px';
      buy.parentNode.insertBefore(connect, label);
    }

    // Banner for non-injected environments (Safari) – will be replaced by WalletConnect flow
    const showNoWalletBanner = () => {
      let bar = $('#noWalletBar');
      if (window.ethereum) { if (bar) bar.remove(); return; }
      if (!bar) {
        bar = document.createElement('div'); bar.id='noWalletBar';
        bar.style.cssText='margin:8px 0 12px 0;padding:10px;border:1px solid #e6b800;background:#fff8e1;border-radius:12px;color:#553;max-width:520px';
        bar.textContent = 'No wallet detected. Tap Connect to use WalletConnect.';
        connect.parentNode.insertBefore(bar, connect);
      }
    };

    const toast = {
      info:(m)=>(window.toast?.info||console.log)(m),
      ok:(m)=>(window.toast?.ok||console.log)(m),
      err:(m)=>(window.toast?.err||console.error)(m)
    };
    const norm = v => (v==null?'':String(v).trim()).replace(/[, ]+/g,'');
    const isNum = s => /^[0-9]*\.?[0-9]+$/.test(s);
    const readAmt = () => { const s=norm(amt.value); return s&&isNum(s) ? s : null; };
    const MIN = 0.001;
    const gate = () => { const n=parseFloat(readAmt()??'NaN'); const ok=Number.isFinite(n)&&n>=MIN; buy.disabled=!ok; return ok; };
    if (!amt.value) amt.value=''; ['input','change','keyup'].forEach(ev=>amt.addEventListener(ev,gate,{passive:true})); gate();
    amt.addEventListener('keypress',e=>{ if(e.key==='Enter'){ e.preventDefault(); buy.click(); } }, {passive:false});

    // --- WalletConnect provider if no injected window.ethereum ---
    let wcProvider; // will also set window.ethereum to this, so the rest of the site works
    async function ensureProvider() {
      if (window.ethereum) return window.ethereum;
      if (!window.WalletConnectProvider?.EthereumProvider) {
        showNoWalletBanner(); throw new Error('WalletConnect not loaded');
      }
      wcProvider = await window.WalletConnectProvider.EthereumProvider.init({
        projectId: 'YOUR_WALLETCONNECT_PROJECT_ID',   // <- replace this
        showQrModal: true,
        chains: [1],  // Ethereum mainnet
        methods: ['eth_sendTransaction','eth_sign','personal_sign','eth_signTypedData'],
        optionalMethods: ['eth_accounts','eth_chainId','eth_requestAccounts','wallet_switchEthereumChain']
      });
      await wcProvider.enable(); // opens wallet selection / deep link on iPhone
      // Polyfill to behave like an injected provider
      window.ethereum = wcProvider;
      return wcProvider;
    }

    // --- Fallback handleBuy (ethers v6) if page didn’t define one
    (function installHandleBuy(){
      if (typeof window.handleBuy === 'function') return;
      if (!window.ethers) { console.warn('[Gate10] ethers.js not found'); return; }
      const PRESALE = window.PRESALE_ADDRESS
        || (window.EXWIFE_ENV && (window.EXWIFE_ENV.presale || window.EXWIFE_ENV.PRESALE))
        || '0xF4A37B656A33d418FB37280c9304274078A9b3ed';
      const ABI = ["function buy() payable"];

      const sanitizeAmount = (x) => {
        if (x && typeof x === 'object' && ('type' in x || 'preventDefault' in x)) {
          const s = readAmt(); if (!s) throw new Error('Enter an amount (ETH).'); return parseFloat(s);
        }
        const s = norm(x); if (!s || !isNum(s)) throw new Error('Enter a valid amount (ETH).');
        return parseFloat(s);
      };

      window.handleBuy = async function(amountEth){
        const providerLike = await ensureProvider(); // injected or WC
        const provider = new ethers.BrowserProvider(providerLike);
        // connect (WalletConnect handles this inside enable, but harmless to call)
        try {
          const accts = await providerLike.request?.({ method:'eth_accounts' });
          if (!accts || !accts.length) await providerLike.request?.({ method:'eth_requestAccounts' });
        } catch {}
        const signer = await provider.getSigner();
        const presale = new ethers.Contract(PRESALE, ABI, signer);
        const n = sanitizeAmount(amountEth);
        const value = ethers.parseEther(String(n));

        let estimate; try { estimate = await presale.buy.estimateGas({ value }); } catch {}
        try {
          const fee = await provider.getFeeData();
          const tx = await presale.buy({
            value,
            maxFeePerGas: fee.maxFeePerGas ?? undefined,
            maxPriorityFeePerGas: fee.maxPriorityFeePerGas ?? undefined,
            gasLimit: estimate ?? undefined
          });
          toast.info('Submitting… confirm in your wallet');
          const rcpt = await tx.wait(); toast.ok('Transaction confirmed');
          if (typeof window.EXWIFE_refreshRaised === 'function') { try { await window.EXWIFE_refreshRaised(); } catch {} }
          return rcpt;
        } catch (e) {
          const msg = e?.message || String(e);
          // Auto-fallback if RPC doesn’t support 1559 priority fee
          if (/eth_maxPriorityFeePerGas|-32601/.test(msg)) {
            let gasPrice; try { const fd = await provider.getFeeData(); gasPrice = fd.gasPrice || await provider.send('eth_gasPrice',[]);} catch {}
            const tx = await presale.buy({ value, type:0, gasPrice: gasPrice ?? undefined, gasLimit: estimate ?? undefined });
            toast.info('Submitting… confirm in your wallet');
            const rcpt = await tx.wait(); toast.ok('Transaction confirmed');
            if (typeof window.EXWIFE_refreshRaised === 'function') { try { await window.EXWIFE_refreshRaised(); } catch {} }
            return rcpt;
          }
          toast.err('Buy error: ' + msg); throw e;
        }
      };
      window.handleBuy.__gate10_wc__ = true;
    })();

    // 6) Wire Buy handler (clean states)
    const onTap = async () => {
      if (!gate()) { (window.toast?.err || console.error)('Enter ≥ 0.001 ETH.'); return; }
      try {
        await ensureProvider(); // ensures injected or WC
      } catch (e) { (window.toast?.err || console.error)('Connect a wallet first.'); return; }
      const n = parseFloat(readAmt() ?? 'NaN'); if (!Number.isFinite(n)) { (window.toast?.err || console.error)('Enter a valid amount.'); return; }
      const hb = (typeof window.handleBuy === 'function') ? window.handleBuy : null;
      if (!hb) { (window.toast?.err || console.error)('Buy not ready. Try again.'); return; }
      const orig = buy.textContent; buy.textContent='Buying…'; buy.disabled=true;
      try { await hb(n); } catch (e) { /* surfaced via toast */ }
      finally { buy.textContent=orig; gate(); }
    };

    // Detach unknown listeners and rebind our own (avoid event-as-amount bugs)
    buy.removeAttribute('onclick'); try { buy.onclick=null; } catch {}
    ['click','touchend','pointerup'].forEach(t => { buy.addEventListener(t, onTap, {capture:false}); });

    // Connect button explicitly opens the WC flow if needed
    connect.addEventListener('click', async ()=>{
      try { await ensureProvider(); (window.toast?.ok||console.log)('Wallet connected'); }
      catch (e){ (window.toast?.err||console.error)(e?.message||String(e)); }
    });

    buy.title = 'gate10-inline-amount v5';
  } catch (e) { console.error('[Gate10] init failed:', e); }
})();

</script>

<script id="wc-lazy-connect">
(() => {
  const $ = (s,r=document)=>r.querySelector(s);
  let connect = document.getElementById("connectBtn");
  if (!connect) {
    connect = document.createElement("button");
    connect.id = "connectBtn";
    connect.type = "button";
    connect.textContent = "Connect Wallet";
    connect.style.cssText = "display:inline-block;margin:0 0 10px 0;padding:8px 12px;border-radius:10px;border:1px solid #bbb;background:#f6f7f9;color:#111;font-size:14px";
    const buy = document.getElementById("buyBtn");
    const label = document.getElementById("amountLabel") || buy;
    buy && buy.parentNode.insertBefore(connect, label);
  }

  // Fallback banner shown only if no provider right now
  function ensureBanner(){
    let bar = document.getElementById("noWalletBar");
    if (window.ethereum) { if (bar) bar.remove(); return; }
    if (!bar) {
      bar = document.createElement("div");
      bar.id = "noWalletBar";
      bar.style.cssText = "margin:8px 0 12px 0;padding:10px;border:1px solid #e6b800;background:#fff8e1;border-radius:12px;color:#553;max-width:520px";
      bar.innerHTML = `
        No wallet detected. You can try WalletConnect or open in your wallet:
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <a href="https://metamask.app.link/dapp/${location.host}" style="flex:1 0 auto;padding:8px 10px;border-radius:10px;background:#1f2937;color:#fff;text-decoration:none;text-align:center">Open in MetaMask</a>
          <a href="https://go.cb-w.com/dapp?cb_url=${encodeURIComponent(location.origin)}" style="flex:1 0 auto;padding:8px 10px;border-radius:10px;background:#0a84ff;color:#fff;text-decoration:none;text-align:center">Open in Coinbase Wallet</a>
        </div>`;
      connect.parentNode.insertBefore(bar, connect);
    }
  }
  ensureBanner();

  async function lazyLoadWC(){
    // only load when user taps Connect; never block the page
    function add(src){return new Promise((res,rej)=>{const s=document.createElement("script");s.src=src;s.async=true;s.onload=res;s.onerror=()=>rej(new Error("load fail: "+src));document.head.appendChild(s);});}
    if (!window.WalletConnectProvider?.EthereumProvider) {
      try { await add("https://unpkg.com//ethereum-provider/dist/index.umd.js"); }
      catch { await add("https://cdn.jsdelivr.net/npm//ethereum-provider/dist/index.umd.js"); }
    }
    if (!window.WalletConnectProvider?.EthereumProvider) throw new Error("WalletConnect script blocked");
  }

  connect.addEventListener("click", async () => {
    try {
      // If already have a provider (MM in-app), done
      if (window.ethereum) { ensureBanner(); (window.toast?.ok||console.log)("Wallet already available"); return; }
      await lazyLoadWC();
      const prov = await window.WalletConnectProvider.EthereumProvider.init({
        projectId: "",
        showQrModal: true,
        chains: [1],
        methods: ["eth_sendTransaction","eth_sign","personal_sign","eth_signTypedData","eth_requestAccounts","eth_accounts"],
        optionalMethods: ["wallet_switchEthereumChain","eth_chainId"]
      });
      await prov.enable(); // opens chooser/deep link
      window.ethereum = prov; // expose provider for the rest of the site
      ensureBanner();
      (window.toast?.ok||console.log)("Wallet connected via WalletConnect");
    } catch (e) {
      (window.toast?.err||console.error)("Connect failed: " + (e?.message || e));
      // Banner remains with deep links as fallback
    }
  }, { once:false });
})();
</script>

<!-- WC UMD (safe) -->
<script src="https://unpkg.com//modal.6.2/dist/index.umd.js"></script>
<script src="https://unpkg.com//ethereum-provider.11.2/dist/index.umd.js"></script>
<!-- /WC UMD -->

<!-- WC UMD (stable) -->
<script src="https://unpkg.com/@walletconnect/modal@2.6.2/dist/index.umd.js"></script>
<script src="https://unpkg.com/@walletconnect/ethereum-provider@2.11.2/dist/index.umd.js"></script>
<!-- /WC UMD -->

<!-- BEGIN GATE10_MOBILE_CONNECT_BUY -->
<script>
(() => {
  const PROJECT_ID = "3d93076061de5b64f55d16591d98dad5";
  const PRESALE = (window.PRESALE_ADDRESS || "0xF4A37B656A33d418FB37280c9304274078A9b3ed");
  const PRESALE_ABI_MIN = ["function buy() payable","function paused() view returns (bool)"];

  let _eip1193=null, _provider=null, _signer=null;
  const byId=(id)=>document.getElementById(id);
  const toast=(window.toast||{info:console.log, ok:console.log, err:console.error});
  const isIOS=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;

  function ensureNoWalletBanner(){
    if (window.ethereum || document.querySelector("#noWalletBanner")) return;
    const host=location.host;
    const div=document.createElement("div");
    div.id="noWalletBanner";
    div.style.cssText="position:fixed;left:12px;right:12px;bottom:12px;background:#111;color:#fff;padding:12px;border-radius:14px;box-shadow:0 8px 26px rgba(0,0,0,.3);z-index:9999";
    div.innerHTML='<div style="font-weight:600;margin-bottom:6px">No wallet detected</div><div style="opacity:.9;margin-bottom:10px">Open in a mobile wallet:</div><div style="display:flex;gap:8px;flex-wrap:wrap"><a href="https://metamask.app.link/dapp/'+host+'" target="_blank" style="padding:8px 12px;background:#f6851b;color:#111;border-radius:10px;font-weight:600;text-decoration:none">Open in MetaMask</a><a href="https://go.cb-w.com/dapp?cb_url='+encodeURIComponent(location.href)+'" target="_blank" style="padding:8px 12px;background:#0052ff;color:#fff;border-radius:10px;font-weight:600;text-decoration:none">Open in Coinbase Wallet</a></div>';
    document.body.appendChild(div);
  }

  async function wcInit(chainId=1){
    const EthereumProvider=window.WalletConnectEthereumProvider?.default||window.WalletConnectEthereumProvider;
    if(!EthereumProvider) throw new Error("WalletConnect provider not loaded");
    return await EthereumProvider.init({
      projectId: PROJECT_ID, chains:[chainId], showQrModal:true,
      methods:["eth_sendTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],
      optionalMethods:["eth_accounts","eth_requestAccounts"],
      events:["chainChanged","accountsChanged","disconnect"]
    });
  }

  async function connectWallet(){
    try{
      if(window.ethereum?.request){
        await window.ethereum.request({method:"eth_requestAccounts"});
        _eip1193=window.ethereum;
        _provider=new ethers.BrowserProvider(_eip1193);
        _signer=await _provider.getSigner();
        toast.ok("Wallet connected");
        return {type:"injected", provider:_provider};
      }
      const wc=await wcInit(1);
      await wc.enable();
      _eip1193=wc;
      _provider=new ethers.BrowserProvider(_eip1193);
      _signer=await _provider.getSigner();
      toast.ok("Wallet connected via WalletConnect");
      return {type:"walletconnect", provider:_provider};
    }catch(e){
      toast.err("Connect failed: "+(e?.message||e));
      if(isIOS()) ensureNoWalletBanner();
      throw e;
    }
  }

  async function handleBuyMobileSafe(){
    const amtEl=byId("amount")||byId("gate10Amt");
    const raw=amtEl?.value?.trim();
    if(!raw){ toast.err("Enter an amount in ETH."); return; }
    try{ if(!_signer) await connectWallet(); } catch { return; }

    try{
      const net=await _provider.getNetwork();
      if(Number(net.chainId)!==1){
        try{ await _eip1193.request({method:"wallet_switchEthereumChain", params:[{chainId:"0x1"}]}); }
        catch{ toast.err("Please switch to Ethereum Mainnet in your wallet."); return; }
      }
    }catch(e){ console.warn("Network check failed:", e); }

    try{
      const presale=new ethers.Contract(PRESALE,PRESALE_ABI_MIN,_signer);
      let paused=false; try{ paused=await presale.paused(); } catch{}
      if(paused){ toast.err("Presale is paused."); return; }
      const amtWei=ethers.parseEther(String(raw));
      toast.info("Submitting transaction… Confirm in your wallet");
      const tx=await presale.buy({ value: amtWei });
      const rc=await tx.wait();
      toast.ok("Success! Hash: "+(tx.hash||rc?.hash));
      if(typeof window.EXWIFE_refreshRaised==="function"){
        try{ await window.EXWIFE_refreshRaised(); } catch(e){ console.warn("refreshRaised failed:", e); }
      }
    }catch(e){
      toast.err("Buy error: "+(e?.shortMessage||e?.message||e));
      console.error(e);
    }
  }

  function wireUI(){
    const connectBtn=document.getElementById("connectBtn")||document.getElementById("gate10Connect")||document.querySelector("[data-connect]");
    const buyBtn=document.getElementById("buyBtn")||document.getElementById("gate10Buy")||document.querySelector("[data-buy]");
    if(connectBtn && !connectBtn.__wired){
      ["click","touchend"].forEach(evt=>connectBtn.addEventListener(evt,e=>{e.preventDefault();connectWallet();},{passive:true}));
      connectBtn.__wired=true;
    }
    if(buyBtn && !buyBtn.__wired){
      ["click","touchend"].forEach(evt=>buyBtn.addEventListener(evt,async e=>{e.preventDefault();await handleBuyMobileSafe();},{passive:true}));
      buyBtn.__wired=true;
    }
  }

  window.EXWIFE_connect=connectWallet;
  window.EXWIFE_buyInline=handleBuyMobileSafe;

  document.addEventListener("DOMContentLoaded", wireUI);
  setTimeout(wireUI, 500);
})();
</script>
<!-- END GATE10_MOBILE_CONNECT_BUY -->
</body></body>
</html>
<script id="gate10-selfheal-ui-js">
(()=>{try{
  const q=(s,r=document)=>r.querySelector(s);

  // Inject mobile CSS
  (function(){
    const css=[
      "@media (max-width:520px){",
      "#ex-dock{position:fixed;left:0;right:0;bottom:0;z-index:2147483646;",
      "padding:10px env(safe-area-inset-right) calc(10px + env(safe-area-inset-bottom)) env(safe-area-inset-left);",
      "background:rgba(18,18,22,.92);backdrop-filter:saturate(120%) blur(10px);",
      "box-shadow:0 -8px 24px rgba(0,0,0,.35)}",
      "#ex-dock .row{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;align-items:center}",
      "#ex-dock input{min-height:44px;font-size:16px;padding:10px 12px;border-radius:12px;background:#0f172a;color:#e7e7ea;border:1px solid #1f2937;width:100%}",
      "#ex-dock button{min-height:44px;padding:12px 14px;border-radius:12px;background:#1f2937;color:#e7e7ea;border:1px solid #334155}",
      "#ex-dock #buyBtn{background:#2563eb;border-color:#1d4ed8;color:#fff}",
      "body{padding-bottom:96px}",
      "footer,.legal,.disclaimer,[data-footer],[data-legal]{max-height:32px;overflow:hidden;opacity:.7}",
      "}"
    ].join("");
    const s=document.createElement("style"); s.id="gate10-mobile-css"; s.textContent=css; document.head.appendChild(s);
  })();

  // Find/create amount input
  let amt=q("#amount")||q("#buyAmount")||q("input");
  const buy=q("#buyBtn")||Array.from(document.querySelectorAll("button")).find(b=>/buy/i.test(b.textContent||""));
  const max=q("#maxBtn")||null;
  const ref=q("#refreshBtn")||q("#refresh")||null;

  if(!amt){
    amt=document.createElement("input");
    amt.id="amount"; amt.type="text"; amt.autocapitalize="off"; amt.autocomplete="off";
  }
  amt.setAttribute("inputmode","decimal");
  amt.setAttribute("step","0.001");
  if(!amt.getAttribute("min")) amt.setAttribute("min","0.001");
  if(!amt.getAttribute("placeholder")) amt.setAttribute("placeholder","0.001 (min)");
  if(/^0?\.?0*1$/.test((amt.value||"").trim())) amt.value=""; // clear stray .01 default

  // Normalize Buy label & type
  if(buy){
    const t=(buy.textContent||"").trim();
    if(/buy/i.test(t) && /eth/i.test(t)) buy.textContent="Buy";
    if(!buy.type||buy.type.toLowerCase()!=="button") buy.type="button";
  }

  // Dock ORIGINAL nodes
  const isMobile=()=>matchMedia("(max-width:520px)").matches;
  const mountDock=()=>{
    if(!isMobile()||document.querySelector("#ex-dock")) return;
    const dock=document.createElement("div"); dock.id="ex-dock"; dock.innerHTML="<div class=\"row\"></div>";
    document.body.appendChild(dock);
    const row=dock.firstElementChild;
    if(!amt.isConnected) row.appendChild(amt);
    if(buy) row.appendChild(buy);
    if(max) row.appendChild(max);
    if(ref) row.appendChild(ref);
    const keep=()=>{ try{ dock.scrollIntoView({block:"end"});}catch(e){} };
    ["focus","click"].forEach(ev=> amt.addEventListener(ev, keep, {passive:true}));
  };
  mountDock();
  addEventListener("resize",()=>{ if(isMobile()&&!document.querySelector("#ex-dock")) mountDock(); });

  // Enable/disable & Enter-to-buy
  const MIN=0.001, valid=()=>{ const v=parseFloat((amt.value||"").trim()); return Number.isFinite(v)&&v>=MIN; };
  const sync=()=>{ try{ if(buy) buy.disabled=!valid(); }catch(e){} };
  amt.addEventListener("input",sync,{passive:true}); sync();
  const callBuy=(ev)=>{
    if(!valid()){ ev?.preventDefault?.(); return false; }
    try{ amt.blur?.(); }catch(e){}
    const fn=(window.handleBuy||window.EXWIFE_handleBuy||window.buyEXWIFE);
    if(typeof fn==="function") return fn.call(window, ev);
  };
  if(buy){
    buy.onclick=(ev)=>callBuy(ev);
    ["pointerup","touchend","click"].forEach(evt=> buy.addEventListener(evt,(ev)=>callBuy(ev),{capture:false,passive:false}));
  }
  amt.addEventListener("keydown",(e)=>{ if(e.key==="Enter"&&valid()){ e.preventDefault(); try{ buy?.click(); }catch(e){} } },{passive:false});
}catch(e){ console.warn("gate10-selfheal-ui (oneblock) failed:",e); }})();
</script>
